<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Demerara Rise + Global Eocene Radiolaria</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

<style>
html, body { margin: 0; padding: 0; height: 100%; }
#map { width: 100%; height: 100%; }
#filters {
  position: absolute;
  top: 10px;
  left: 10px;
  background: white;
  padding: 10px;
  font-family: sans-serif;
  font-size: 14px;
  z-index: 1;
  border-radius: 4px;
}
</style>
</head>

<body>

<div id="filters">
<strong>Time</strong><br>
<label><input type="checkbox" id="time-eocene" checked> Eocene</label><br>
<label><input type="checkbox" id="time-oligocene"> Oligocene</label><br><br>

<strong>Subject</strong><br>
<label><input type="checkbox" id="sub-stratigraphy" checked> Stratigraphy</label><br>
<label><input type="checkbox" id="sub-taxonomy" checked> Taxonomy</label><br>
<label><input type="checkbox" id="sub-ai" checked> AI</label><br>
<label><input type="checkbox" id="sub-diversity"> Diversity</label><br>
<label><input type="checkbox" id="sub-abundance"> Abundance</label><br><br>

<strong>Type of microorganisms</strong><br>
<label><input type="checkbox" id="micro-foraminifera"> Foraminifera</label><br>
<label><input type="checkbox" id="micro-radiolaria" checked> Radiolaria</label><br>
<label><input type="checkbox" id="micro-diatoms"> Diatoms</label><br>
<label><input type="checkbox" id="micro-coccoliths"> Coccoliths</label><br>
<label><input type="checkbox" id="micro-dinoflagellates"> Dinoflagellates/Dinoflagellate cysts</label><br>
<label><input type="checkbox" id="micro-ostracods"> Ostracods</label><br>
<label><input type="checkbox" id="micro-conodonts"> Conodonts</label>
</div>

<div id="map"></div>

<script>
const map = new maplibregl.Map({
  container: 'map',
  style: 'https://api.maptiler.com/maps/ocean-v4/style.json?key=lNejLh7hvsWMyttHYk5E',
  center: [-54.8, 9.4],
  zoom: 6
});

map.addControl(new maplibregl.NavigationControl());
map.getCanvas().style.cursor = 'default';

let hoverPopup = null;

map.on('load', function() {

  const sitesGeoJSON = {
    type: 'FeatureCollection',
    features: [
      // ===== Leg 207 Sites =====
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-54.72, 9.43] },
        properties: {
          title: 'Leg 207: Site 1258',
          time: 'Eocene',
          subject: ['Radiolaria','Stratigraphy','Taxonomy','AI'],
          microorganism: ['Radiolaria','AI'],
          popupHTML: `
            <strong>Leg 207: Site 1258</strong><br>
            <a href="https://doi.org/10.5194/jm-41-165-2022" target="_blank">Carlsson et al., 2022</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102268" target="_blank">Carlsson et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102293" target="_blank">Pinto et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102296" target="_blank">Tetard et al., 2023</a>
          `
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-54.95, 9.43] },
        properties: {
          title: 'Leg 207: Site 1259',
          time: 'Eocene',
          subject: ['Radiolaria','Stratigraphy','Taxonomy','AI'],
          microorganism: ['Radiolaria','AI'],
          popupHTML: `
            <strong>Leg 207: Site 1259</strong><br>
            <a href="https://doi.org/10.5194/jm-41-165-2022" target="_blank">Carlsson et al., 2022</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102268" target="_blank">Carlsson et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102293" target="_blank">Pinto et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102296" target="_blank">Tetard et al., 2023</a>
          `
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-54.70, 9.30] },
        properties: {
          title: 'Leg 207: Site 1260',
          time: 'Eocene',
          subject: ['Radiolaria','Stratigraphy','Taxonomy','AI'],
          microorganism: ['Radiolaria','AI'],
          popupHTML: `
            <strong>Leg 207: Site 1260</strong><br>
            <a href="https://doi.org/10.5194/jm-41-165-2022" target="_blank">Carlsson et al., 2022</a><br>
            <a href="https://doi.org/10.5194/jm-41-1-2022" target="_blank">Meunier & Danelian, 2022</a><br>
            <a href="https://doi.org/10.1017/jpa.2022.82" target="_blank">Meunier & Danelian, 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102268" target="_blank">Carlsson et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102293" target="_blank">Pinto et al., 2023</a><br>
            <a href="https://doi.org/10.1016/j.marmicro.2023.102296" target="_blank">Tetard et al., 2023</a>
          `
        }
      },

      // ===== Globala Eocene Radiolaria Sites =====
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-76.36, 30.05] },
        properties: {
          title: 'Blake Nose – Site 1051',
          time: 'Eocene',
          subject: ['Radiolaria'],
          microorganism: ['Radiolaria'],
          popupHTML: `
            <strong>Blake Nose – Site 1051</strong><br>
            <a href="https://doi.org/10.1017/jpa.2024.7" target="_blank">Meunier & Danelian, 2024</a>
          `
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-41.09, -28.29] },
        properties: {
          title: 'DSDP Site 356 – São Paulo Plateau',
          time: 'Eocene',
          subject: ['Radiolaria'],
          microorganism: ['Radiolaria'],
          popupHTML: `
            <strong>DSDP Site 356 – São Paulo Plateau</strong><br>
            <a href="https://doi.org/10.1016/j.marmicro.2017.09.004" target="_blank">de Souza et al., 2017</a>
          `
        }
      },
      {
        type: 'Feature',
        geometry: { type: 'Point', coordinates: [-142.16, 12.07] },
        properties: {
          title: 'IODP Site U1331 – Eastern Equatorial Pacific',
          time: 'Eocene',
          subject: ['Radiolaria'],
          microorganism: ['Radiolaria'],
          popupHTML: `
            <strong>IODP Site U1331 – Eastern Equatorial Pacific</strong><br>
            <a href="https://doi.org/10.2204/iodp.proc.320321.202.2012" target="_blank">Kamikuri et al., 2012</a>
          `
        }
      }
    ]
  };

  map.addSource('sites', { type:'geojson', data: sitesGeoJSON });

  map.addLayer({
    id:'site-points',
    type:'circle',
    source:'sites',
    paint:{
      'circle-radius':7,
      'circle-color':'#cc0000',
      'circle-stroke-color':'#000',
      'circle-stroke-width':1
    }
  });

  // Hover
  map.on('mouseenter','site-points', function(e){
    map.getCanvas().style.cursor='pointer';
    hoverPopup = new maplibregl.Popup({closeButton:false, closeOnClick:false})
      .setLngLat(e.lngLat)
      .setHTML('<strong>'+e.features[0].properties.title+'</strong>')
      .addTo(map);
  });
  map.on('mouseleave','site-points', function(){
    map.getCanvas().style.cursor='default';
    if(hoverPopup){hoverPopup.remove(); hoverPopup=null;}
  });

  // Click popup
  map.on('click','site-points', function(e){
    new maplibregl.Popup()
      .setLngLat(e.lngLat)
      .setHTML(e.features[0].properties.popupHTML)
      .addTo(map);
  });

  // ===== FILTER LOGIC =====
  function updateFilters() {
    const timeFilters = ['any'];
    if(document.getElementById('time-eocene').checked) timeFilters.push(['==',['get','time'],'Eocene']);
    if(document.getElementById('time-oligocene').checked) timeFilters.push(['==',['get','time'],'Oligocene']);

    const subjectFilters = ['any'];
    const subjects = [
      ['sub-stratigraphy','Stratigraphy'],
      ['sub-taxonomy','Taxonomy'],
      ['sub-ai','AI'],
      ['sub-diversity','Diversity'],
      ['sub-abundance','Abundance']
    ];
    subjects.forEach(([id,name]) => {
      if(document.getElementById(id).checked) subjectFilters.push(['in',name,['get','subject']]);
    });

    const microFilters = ['any'];
    const micros = [
      ['micro-foraminifera','Foraminifera'],
      ['micro-radiolaria','Radiolaria'],
      ['micro-diatoms','Diatoms'],
      ['micro-coccoliths','Coccoliths'],
      ['micro-dinoflagellates','Dinoflagellates/Dinoflagellate cysts'],
      ['micro-ostracods','Ostracods'],
      ['micro-conodonts','Conodonts']
    ];
    micros.forEach(([id,name]) => {
      if(document.getElementById(id).checked) microFilters.push(['in',name,['get','microorganism']]);
    });

    const filters = ['all', ['any'].concat(timeFilters.slice(1)), ['any'].concat(subjectFilters.slice(1)), ['any'].concat(microFilters.slice(1))];

    map.setFilter('site-points', filters);
  }

  document.querySelectorAll('#filters input').forEach(el => { el.onchange = updateFilters; });
  updateFilters();

});
</script>

</body>
</html>
